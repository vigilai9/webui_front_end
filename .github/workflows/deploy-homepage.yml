name: Deploy to cPanel

on:
  push:
    branches: [ home_page ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: Install dependencies
      run: npm install

    - name: Build project
      run: npm run build

    - name: Verify build output
      run: ls -la out/

    - name: Create home_page directory
      uses: appleboy/ssh-action@master
      with:
        host: 's3cura.ai'
        username: 'iqfu27x9dob7'
        password: 'Gaurav123#'
        port: 22
        script: |
          mkdir -p /home/iqfu27x9dob7/public_html/home_page
          chmod 755 /home/iqfu27x9dob7/public_html/home_page

    - name: Upload files using tar
      uses: appleboy/scp-action@master
      with:
        host: 's3cura.ai'
        username: 'iqfu27x9dob7'
        password: 'Gaurav123#'
        port: 22
        source: "out/"
        target: "/home/iqfu27x9dob7/public_html/home_page"
        overwrite: true
        strip_components: 1  # This removes the 'out' directory from the path